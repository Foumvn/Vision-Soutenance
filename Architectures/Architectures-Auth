Parfait, l√† on passe clairement au **niveau Master 2 / soutenance** üí™
Je vais te donner **un syst√®me d‚Äôauthentification complet**, avec :

1. **La mod√©lisation conceptuelle (r√¥les & logique)**
2. **Le mod√®le de donn√©es (entit√©s)**
3. **Les diagrammes UML cl√©s**

   * Diagramme de cas d‚Äôutilisation
   * Diagramme de classes
   * Diagramme de s√©quence (authentification)
4. **Des diagrammes UML pr√™ts √† g√©n√©rer (PlantUML)**
   üëâ tu peux les transformer en images facilement pour ton PDF.

---

## 1Ô∏è‚É£ Mod√©lisation du syst√®me d‚Äôauthentification

### üéØ Objectif

S√©curiser l‚Äôacc√®s √† une **plateforme de visioconf√©rence intelligente** int√©grant :

* des utilisateurs humains
* un **agent IA (participant virtuel)**
* des services IA invisibles (STT / TTS / Vision)

---

### üë§ Acteurs du syst√®me

| Acteur         | Description                         |
| -------------- | ----------------------------------- |
| Utilisateur    | Participant humain (audio/vid√©o)    |
| Administrateur | G√®re utilisateurs, r√©unions, droits |
| Agent IA       | Participant virtuel intelligent     |
| Service IA     | STT / TTS / Vision (non interactif) |

---

### üîê Types d‚Äôauthentification

| Type                                      | Usage               |
| ----------------------------------------- | ------------------- |
| Authentification par email + mot de passe | Utilisateurs        |
| JWT / Session Token                       | Acc√®s API & LiveKit |
| API Key / OAuth                           | Services IA         |
| Token LiveKit                             | Acc√®s aux rooms     |

---

## 2Ô∏è‚É£ Mod√®le de donn√©es (entit√©s)

### üóÇÔ∏è Entit√©s principales

#### **User**

* id
* email
* password_hash
* role (USER, ADMIN)
* language_preference
* created_at

#### **Meeting**

* id
* title
* created_by
* start_time
* end_time

#### **LiveKitToken**

* id
* user_id
* room_name
* permissions
* expires_at

#### **IAAgent**

* id
* name
* capabilities (STT, r√©sum√©, vision)
* status

#### **Group**

* id
* name
* description
* created_by (User ID)
* members (List of User IDs)
* created_at

---

## 3Ô∏è‚É£ UML ‚Äì Diagramme de cas d‚Äôutilisation

### üé≠ Cas d‚Äôutilisation principaux

* S‚Äôinscrire
* Se connecter
* Rejoindre une r√©union
* G√©n√©rer un token LiveKit
* Interagir avec l‚Äôagent IA
* Administrer le syst√®me
* Cr√©er/G√©rer des groupes d'utilisateurs

### üìê Diagramme UML (PlantUML)

```plantuml
@startuml
actor Utilisateur
actor Administrateur
actor "Agent IA" as IA

Utilisateur --> (S'inscrire)
Utilisateur --> (Se connecter)
Utilisateur --> (Rejoindre r√©union)
Utilisateur --> (Recevoir assistance IA)

Administrateur --> (G√©rer utilisateurs)
Administrateur --> (G√©rer r√©unions)

IA --> (Analyser audio)
IA --> (Analyser vid√©o)
IA --> (Fournir assistance)
@enduml
```

---

## 4Ô∏è‚É£ UML ‚Äì Diagramme de classes

### üß± Structure du syst√®me

```plantuml
@startuml
class User {
  +id: UUID
  +email: String
  +passwordHash: String
  +role: Role
  +language: String
}

class Meeting {
  +id: UUID
  +title: String
  +startTime: Date
  +endTime: Date
}

class LiveKitToken {
  +token: String
  +expiresAt: Date
}

class IAAgent {
  +id: UUID
  +name: String
  +capabilities: List
}

class Group {
  +id: UUID
  +name: String
  +createdBy: UUID
}

User "1" -- "0..*" Meeting : participe
User "1" -- "0..*" LiveKitToken
Meeting "1" -- "1" IAAgent
User "1" -- "0..*" Group : cree
Group "0..*" -- "1..*" User : membres
Meeting "0..*" -- "0..*" Group : invitation
@enduml
```

---

## 5Ô∏è‚É£ UML ‚Äì Diagramme de s√©quence (authentification)

### üîÑ Flux : Connexion utilisateur

```plantuml
@startuml
actor Utilisateur
participant "Frontend" as FE
participant "Backend API" as API
participant "Auth Service" as AUTH
participant "LiveKit Server" as LK

Utilisateur -> FE : Saisit email / mot de passe
FE -> API : POST /login
API -> AUTH : V√©rifier identifiants
AUTH --> API : OK + JWT
API -> LK : G√©n√©rer token LiveKit
LK --> API : LiveKit Token
API --> FE : JWT + LiveKit Token
FE --> Utilisateur : Acc√®s autoris√©
@enduml
```
---

## 6Ô∏è‚É£ Architecture Frontend (Web & Mobile)

### üèóÔ∏è Strat√©gie Multi-Plateforme

L‚Äôapplication repose sur une s√©paration stricte entre la couche de pr√©sentation et la logique m√©tier, permettant une coh√©rence entre le **Web (Next.js)** et le **Mobile (Flutter)**.

#### **Web (Next.js 15+ App Router)**
*   **Gestion d'√©tat :** React Context API (AuthContext) pour le partage global de la session.
*   **Protection des routes :** Middleware Next.js pour intercepter les acc√®s non authentifi√©s aux routes `/dashboard` ou `/meeting`.
*   **Persistance :** Cookies HTTP-only pour la session JWT (s√©curit√© XSS).

#### **Mobile (Flutter)**
*   **Gestion d'√©tat :** `Provider` (ChangeNotifier) pour le flux d'authentification.
*   **Protection des routes :** Guarding via `GoRouter` ou redirection logique dans `main.dart`.
*   **Persistance :** `flutter_secure_storage` pour stocker le JWT de mani√®re encrypt√©e.

---

### üì° Couche de Communication (API Client)

Les deux clients impl√©mentent un **Intercepteur** pour automatiser la gestion du cycle de vie du token :

1.  **Request Interceptor :** Injecte automatiquement le header `Authorization: Bearer <token>`.
2.  **Response Interceptor :** Capture les erreurs `401 Unauthorized` pour d√©connecter l'utilisateur ou tenter un rafra√Æchissement de token.

---

### üîÑ Diagramme de S√©quence : Int√©gration LiveKit (Frontend)

Ce diagramme d√©taille comment le frontend obtient l'acc√®s s√©curis√© √† une salle de r√©union.

```plantuml
@startuml
participant "Frontend Client" as FE
participant "Backend API" as API
participant "LiveKit Server" as LK

FE -> API : POST /meetings/join (RoomID, UserID)
activate API
API -> API : V√©rifier droits d'acc√®s
API -> LK : Request Access Token (Grants: join=true)
LK --> API : Signed JWT Token
API --> FE : 200 OK (LiveKit Token + Room Metadata)
deactivate API

FE -> LK : Connect(WS URL, LiveKit Token)
LK --> FE : Connection Established (Audio/Video Streams)
@enduml
```

---

### üõ°Ô∏è S√©curit√© de la Session

| Couche | M√©canisme | Objectif |
| :--- | :--- | :--- |
| **Stockage** | Secure Storage (Mobile) / HttpOnly (Web) | Protection contre le vol de tokens. |
| **Transport** | TLS (HTTPS / WSS) | Chiffrement point-√†-point. |
| **Validation** | JWT Expiration | Limitation de la dur√©e de vie de la session. |
| **Acc√®s Room** | Token Ephemeral LiveKit | Droit d'acc√®s limit√© √† une seule r√©union sp√©cifique. |

---

## 7Ô∏è‚É£ Synth√®se des Flux d'Authentification

1.  **Enregistrement/Connexion :** Email/Pass -> Validation Backend -> Retour JWT.
2.  **Initialisation App :** V√©rification du token local -> Auto-login si valide.
3.  **Acc√®s Meeting :** Requ√™te au backend -> R√©cup√©ration du token LiveKit sp√©cifique -> Connexion au serveur de m√©dia.
